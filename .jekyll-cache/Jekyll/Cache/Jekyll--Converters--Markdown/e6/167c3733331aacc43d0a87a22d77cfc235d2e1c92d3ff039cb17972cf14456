I"×"<blockquote>
  <p><a href="/2020/02/02/0.magento-menu.html">Magento 2 å¼€å‘å†…å®¹ç›®å½•</a></p>
</blockquote>

<p>æœ¬æ–‡ä»¶è®¨è®ºMagneto 2 äº‹ä»¶åˆ—è¡¨ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒMagento 2 ä¸»è¦ä½¿ç”¨äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œéå¸¸ä¾¿äºæ‰©å±•ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ã€‚å¯ä»¥æŠŠäº‹ä»¶çœ‹ä½œåœ¨æŸç§æƒ…å†µå‘ç”Ÿæ—¶æŠ›å‡ºçš„ä¿¡å·æ——ã€‚ç»§ç»­ä½¿ç”¨ä¹‹å‰çš„ HelloWorld æ¨¡å—æ¼”ç¤ºæœ¬èŠ‚ä»£ç ã€‚</p>

<p>å†…å®¹ç›®å½•ï¼š</p>

<ul>
  <li>è§¦å‘äº‹ä»¶</li>
  <li>ç›‘å¬å¤„ç†äº‹ä»¶
    <ul>
      <li>äº‹ä»¶èŒƒå›´</li>
      <li>æ·»åŠ  event.xml</li>
      <li>ç›‘å¬å™¨</li>
    </ul>
  </li>
  <li>Magneto 2 ç³»ç»Ÿæ‰€æœ‰äº‹ä»¶åˆ—è¡¨
    <ul>
      <li>PHP æ–‡ä»¶ä¸­çš„äº‹ä»¶</li>
      <li>JS ä¸­çš„äº‹ä»¶</li>
    </ul>
  </li>
</ul>

<h2 id="è§¦å‘äº‹ä»¶">è§¦å‘äº‹ä»¶</h2>

<p>å¯ä»¥ä½¿ç”¨ç±» <code class="language-plaintext highlighter-rouge">Magento\Framework\Event\Manager</code> è§¦å‘äº‹ä»¶ã€‚å¦‚ä¸‹é¢è¿™ä¸ªæ§åˆ¶å™¨åªæ˜¯æ˜¾ç¤º â€œHello Worldâ€ æ–‡å­—</p>

<p>æ–‡ä»¶ï¼š <code class="language-plaintext highlighter-rouge">app/code/Aqrun/HelloWorld/Controller/Index/Text.php</code></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Aqrun\HelloWorld\Controller\Index</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Text</span> <span class="k">extends</span> <span class="err">\</span><span class="nc">Magento\Framework\App\Action\Action</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">execute</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s1">'Hello World'</span><span class="p">;</span>
        <span class="k">exit</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ç°åœ¨å¦‚æœæƒ³è§¦å‘ä¸€ä¸ªäº‹ä»¶å¯ä»¥è®©å…¶å®ƒæ¨¡å—èƒ½å¤Ÿä¿®æ”¹ä¸Šé¢æ˜¾ç¤ºçš„æ–‡å­—å†…å®¹ã€‚å¯ä»¥åšå¦‚ä¸‹ä¿®æ”¹ï¼š</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Aqrun\HelloWorld\Controller\Index</span><span class="p">;</span>
<span class="kd">class</span> <span class="nc">Text</span> <span class="k">extends</span> <span class="err">\</span><span class="nc">Magento\Framework\App\Action\Action</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">execute</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$textDisplay</span> <span class="o">=</span> <span class="k">new</span> <span class="err">\</span><span class="nf">Magento\Framework\DataObject</span><span class="p">([</span><span class="s1">'text'</span> <span class="o">=&gt;</span> <span class="s1">'ä¿®æ”¹å‰è¦æ˜¾ç¤ºçš„æ–‡å­—'</span><span class="p">]);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">_eventManager</span><span class="o">-&gt;</span><span class="nf">dispatch</span><span class="p">(</span><span class="s1">'aqrun_helloworld_display_text'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'textDisplay'</span> <span class="o">=&gt;</span> <span class="nv">$textDisplay</span><span class="p">]);</span>
        <span class="k">echo</span> <span class="nv">$textDisplay</span><span class="o">-&gt;</span><span class="nb">getText</span><span class="p">();</span>
        <span class="k">exit</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">display()</code> æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šå…¨å±€å”¯ä¸€çš„äº‹ä»¶æ ‡è¯†åŠä¸€ä¸ªæ•°æ®æ•°ç»„ã€‚ä¸Šé¢ä»£ç ä¸»è¦æ˜¯æŠŠæ–‡å­—å…ˆå˜æˆå¯¹è±¡å½¢å¼ä¼ ç»™äº‹ä»¶ï¼Œç„¶åå†ä»å¯¹è±¡é‡æ–°è·å–æ–‡å­—ã€‚</p>

<h2 id="ç›‘å¬å’Œå¤„ç†äº‹ä»¶">ç›‘å¬å’Œå¤„ç†äº‹ä»¶</h2>

<h3 id="äº‹ä»¶èŒƒå›´">äº‹ä»¶èŒƒå›´</h3>

<p>Magentoç³»ç»Ÿæœ‰èŒƒå›´çš„å®šä¹‰ã€‚åˆ†ä¸ºå‰ç«¯èŒƒå›´å’Œåå°èŒƒå›´ã€‚å¯¹äºé…ç½®æ–‡ä»¶å°±ä¼šæœ‰3ä¸ªåœ°æ–¹å¯ä»¥æ”¾ï¼š</p>

<ul>
  <li>etc/ æ–‡ä»¶å¤¹ä¸­çš„é…ç½®æ–‡ä»¶æ˜¯å‰ç«¯åå°å…¬ç”¨çš„</li>
  <li>etc/frontend/ ç›®å½•é…ç½®æ–‡ä»¶åªèƒ½å‰ç«¯æœ‰æ•ˆ</li>
  <li>etc/adminhtml/  ç›®å½•æ˜¯åå°å‚æ•°é…ç½®</li>
</ul>

<p>å› æ­¤äº‹ä»¶é…ç½®æ–‡ä»¶å°±ä¼šæœ‰å¦‚ä¸‹ä¸‰ç§ï¼š</p>

<ul>
  <li>åå° app/code/Aqrun/HelloWorld/etc/adminhtml/events.xml</li>
  <li>å‰ç«¯ app/code/Aqrun/HelloWorld/etc/frontend/events.xml</li>
  <li>å…¨å±€  app/code/Aqrun/HelloWorld/etc/events.xml</li>
</ul>

<h3 id="åˆ›å»º-eventsxml">åˆ›å»º events.xml</h3>

<p>æœ¬ä¾‹åªæ˜¯å‰ç«¯ç›‘å¬äº‹ä»¶ä¿®æ”¹æ–‡å­—æ˜¾ç¤ºï¼Œæ‰€ä»¥ events.xml æ–‡ä»¶åœ¨ etc/frontend/ ç›®å½•</p>

<p>æ–‡ä»¶ï¼š <code class="language-plaintext highlighter-rouge">app/code/Aqrun/HelloWorld/etc/frontend/events.xml</code></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="nt">&lt;config</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">"urn:magento:framework:Event/etc/events.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;event</span> <span class="na">name=</span><span class="s">"aqrun_helloworld_display_text"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;observer</span> <span class="na">name=</span><span class="s">"mp_display_text"</span> <span class="na">instance=</span><span class="s">"Aqrun\HelloWorld\Observer\ChangeDisplayText"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/event&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</code></pre></div></div>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œconfig èŠ‚ç‚¹ä¸‹é¢å®šä¹‰äº† event èŠ‚ç‚¹ï¼Œname å±æ€§å€¼æ˜¯ dispatch å‡½æ•°å‘é€äº‹ä»¶æ—¶çš„äº‹ä»¶åç§°ã€‚observer èŠ‚ç‚¹çš„ instance å±æ€§æŒ‡å®šè¿™ä¸ªäº‹ä»¶ç”±å“ªä¸ªç±»å¤„ç†ï¼Œobserver çš„ name å±æ€§æ˜¯ä¸ºäº†åŒºåˆ†å½“å‰äº‹ä»¶çš„å…¶å®ƒç›‘å¬å™¨çš„å”¯ä¸€æ ‡è¯†ã€‚</p>

<h3 id="ç›‘å¬å™¨">ç›‘å¬å™¨</h3>

<p>ç°åœ¨æ·»åŠ ç›‘å¬å™¨ç±»æ¥å¤„ç†ä¸Šé¢çš„äº‹ä»¶</p>

<p>æ–‡ä»¶ï¼š <code class="language-plaintext highlighter-rouge">app/code/Aqrun/HelloWorld/Observer/ChangeDislayText.php</code></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">Aqrun\HelloWorld\Observer</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ChangeDisplayText</span> <span class="k">implements</span> <span class="err">\</span><span class="nc">Magento\Framework\Event\ObserverInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">execute</span><span class="p">(</span>
        <span class="err">\</span><span class="nc">Magento\Framework\Event\Observer</span> <span class="nv">$observer</span>
    <span class="p">){</span>
        <span class="nv">$textDisplay</span> <span class="o">=</span> <span class="nv">$observer</span><span class="o">-&gt;</span><span class="nf">getData</span><span class="p">(</span><span class="s1">'textDisplay'</span><span class="p">);</span>
        <span class="k">echo</span> <span class="nv">$textDisplay</span><span class="o">-&gt;</span><span class="nb">getText</span><span class="p">()</span> <span class="mf">.</span> <span class="s2">" - äº‹ä»¶å¤„ç†ä¸­ &lt;br/&gt;"</span><span class="p">;</span>
        <span class="nv">$textDisplay</span><span class="o">-&gt;</span><span class="nf">setText</span><span class="p">(</span><span class="s1">'äº‹ä»¶å¤„ç†æˆåŠŸï¼Œå†…å®¹å·²ç»ä¿®æ”¹'</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è¿™ä¸ªç±»å®ç°äº† ObserverInterface æ¥å£çš„ execute æ–¹æ³•ã€‚æ¸…é™¤ç¼“å­˜åé¡µé¢æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>

<p><img src="images/10-event-result.png" alt="event result" /></p>

<h2 id="æŸ¥çœ‹ç³»ç»Ÿæ‰€æœ‰äº‹ä»¶åˆ—è¡¨">æŸ¥çœ‹ç³»ç»Ÿæ‰€æœ‰äº‹ä»¶åˆ—è¡¨</h2>

<p>ç³»ç»Ÿæ ¸å¿ƒæ–‡ä»¶å®šä¹‰çš„äº‹ä»¶å¯ä»¥ä½¿ç”¨ç¼–è¾‘å™¨ï¼ˆPHPSTORMç­‰ï¼‰çš„å…¨æ–‡æœç´¢åŠŸèƒ½æŸ¥çœ‹ï¼Œæœç´¢å…³é”®å­—å¦‚ä¸‹ï¼š</p>

<ul>
  <li>PHPäº‹ä»¶   <code class="language-plaintext highlighter-rouge">eventManager-&gt;dispatch</code></li>
  <li>JS äº‹ä»¶   <code class="language-plaintext highlighter-rouge">varienGlobalEvents.fireEvent</code></li>
</ul>

<p>æœç´¢åçš„æºä»£ç å½¢å¦‚ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// php
$this-&gt;_eventManager-&gt;dispatch('sales_quote_remove_item', ['quote_item' =&gt; $item]);

//js 
varienGlobalEvents.fireEvent('gridRowClick', event);
</code></pre></div></div>
:ET