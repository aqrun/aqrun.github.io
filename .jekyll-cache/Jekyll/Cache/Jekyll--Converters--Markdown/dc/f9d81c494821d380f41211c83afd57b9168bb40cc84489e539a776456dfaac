I"<p>Drupal 7 æ•°æ®åº“APIå¢åŠ äº†db_select()æ–¹æ³•ï¼Œå’Œdb_query()ç›¸æ¯”ï¼Œè¯­æ³•æ›´åŠ æ¸…æ™°ï¼Œä½¿ç”¨ä¹Ÿæ›´åŠ æ–¹ä¾¿ã€‚ç›®çš„ä¹Ÿä¸è¨€è€Œå–»ï¼Œå°±æ˜¯å–ä»£db_query()ã€‚ä¸‹é¢æˆ‘ä¹Ÿå°±åˆ—ç½—å‡ºä¸€äº›ç»å¸¸ä½¿ç”¨çš„æŠ€å·§ï¼Œå¯èƒ½ä¸å¤Ÿå…¨é¢ï¼Œè¿˜è¯·å¤§å®¶å¤šå¤šè¡¥å……ã€‚</p>

<h4 id="1-å•è¡¨æŸ¥è¯¢æœ€åŸºæœ¬ä½¿ç”¨æ–¹æ³•">1. å•è¡¨æŸ¥è¯¢ï¼ˆæœ€åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼‰</h4>

<pre class="line-numbers">
    <code class="language-php">
$result = db_select('contact', 'c')  //é€‰æ‹©è¡¨contact,åä¸€ä¸ªåˆ«åc
 -&gt;fields('c') //æŸ¥è¯¢cè¡¨ä¸­çš„å­—æ®µï¼Œåé¢ä¸è·Ÿå‚æ•°å°±æ˜¯æŸ¥è¯¢æ‰€æœ‰
 -&gt;execute()  //æ‰§è¡Œæ“ä½œ
 -&gt;fetchAssoc(); //å¤„ç†ç»“æœé›†
</code>
</pre>

<h4 id="2-æ¡ä»¶æŸ¥è¯¢condition">2. æ¡ä»¶æŸ¥è¯¢ï¼ˆconditionï¼‰</h4>

<pre class="line-numbers">
    <code class="language-php">
    $result = db_select('node', 'n')
    -&gt;fields('n')
    -&gt;condition('nid', 5,'=')  //nidç­‰äº5çš„æ¡ä»¶
    -&gt;condition('status', 0,'&gt;') // çŠ¶æ€å¤§äº0,ä¹Ÿå°±æ˜¯ä¸ºçœŸç­‰äº1
    -&gt;condition('uid', array(1,5,7),'IN') //ä½¿ç”¨INæ“ä½œï¼Œå½“ç„¶è¿˜å¯ä»¥ä½¿ç”¨ NOT IN
    -&gt;execute()
    -&gt;fetchAssoc();
</code>
</pre>

<h4 id="3-è”åˆæŸ¥è¯¢join">3. è”åˆæŸ¥è¯¢ï¼ˆJoinï¼‰</h4>

<pre class="line-numbers">
    <code class="language-php">
 $query = db_select('field_data_field_slide','f'); //ä¸»è¡¨

 $query-&gt;join('node', 'n', 'fa.entity_id = n.nid'); // è”åˆnodeè¡¨,æ¡ä»¶æ˜¯nid

 $query-&gt;condition('f.field_slide_channel_tid',$chanid,'=');

 $query-&gt;condition('n.status','1','=');  //å‘å¸ƒçŠ¶æ€

 $query-&gt;fields('n',array('nid'));  //æŸ¥è¯¢nid

 $query-&gt;orderBy('n.nid','DESC'); //æ’åºæ¡ä»¶

  $query-&gt;range(0,4); //å–å¾—4æ¡æ•°æ®

   $result = $query-&gt;execute();
</code>
</pre>

<h4 id="4-æ·»åŠ å­—æ®µaddfield">4. æ·»åŠ å­—æ®µï¼ˆaddFieldï¼‰</h4>

<pre class="line-numbers">
    <code class="language-php">
    $query = db_select('taxonomy_term_hierarchy','h'); //é€‰æ‹©è¡¨
    $query-&gt;join('taxonomy_term_data','d','h.tid = d.tid'); // è”åˆæŸ¥è¯¢
    $query-&gt;addField('d', 'tid'); // æ·»åŠ å­—æ®µ
    $query-&gt;condition('h.parent',0); // æ·»åŠ æ¡ä»¶where 
    $query-&gt;condition('d.vid',$vid); // å†æ·»åŠ ä¸€ä¸ªæ¡ä»¶ and ....
    $query-&gt;addTag('ditusearch_generate_path'); // æ·»åŠ Tag å¯é€‰é¡¹ï¼Œè¿™ä¸ªå°±æ˜¯æ–¹ä¾¿å…¶ä»–åœ°æ–¹å¯ä»¥æ”¹å˜è¿™   ä¸ªæŸ¥è¯¢$query æ¯”å¦‚å¦‚æœæ·»åŠ äº†tag å¯ä»¥ä½¿ç”¨ hook_query_alter å¯¹å…¶è¿›è¡ŒæŸ¥è¯¢ å¦‚æœä½ ä½¿ç”¨è¿‡viewså¼€å‘ï¼Œviews ä¹Ÿå¯ä»¥äº†ç±»ä¼¼çš„hook
    $tid = $query-&gt;execute()-&gt;fetchCol();
</code>
</pre>

<h4 id="5-åˆ†é¡µä½¿ç”¨pager">5. åˆ†é¡µä½¿ç”¨ï¼ˆpagerï¼‰</h4>

<pre class="line-numbers">
    <code class="language-javascript">
  $query = db_select('node', 'n')
      -&gt;condition('type', 'article')
      -&gt;fields('n');
  $query = $query-&gt;extend('PagerDefault')-&gt;limit(2); //limitæ¡ä»¶æ˜¯åˆ†é¡µæ•°ç›®
  $result = $query-&gt;execute();
  foreach($result as $res){
     $output .= $res-&gt;title;
   }
    $output .= theme(â€˜pagerâ€™); //æ·»åŠ åˆ†é¡µtheme
    Return $output; 
</code></pre>

<h4 id="6-å¤šè¡¨è”åˆåˆ†é¡µ">6. å¤šè¡¨è”åˆåˆ†é¡µ</h4>

<pre class="line-numbers">
    <code class="language-javascript">
  $query = db_select('field_data_field_news','fa')-&gt;extend('PagerDefault'); //å¤šè¡¨è”åˆæŸ¥è¯¢extendæ¡ä»¶å¿…é¡»æ”¾åœ¨db_selectä¹‹å

  $query-&gt;join('node','n','fa.entity_id = n.nid');

  $query-&gt;join('field_data_field_news_date_sort', 'fb', 'fa.entity_id = fb.entity_id');

  $query-&gt;fields('n', array('nid','title'));

  $query-&gt;condition('fa.field_news_classify_tid',$tids,'in'); 

  $query-&gt;condition('n.type','news','='); 

  $query-&gt;condition('n.status','1','=');     

 $query-&gt;orderBy('fb.field_news_date_sort_value','DESC');

  $query-&gt;limit(14);

   $result = $query-&gt;execute();
</code></pre>

<p>http://drupalchina.cn/node/2026</p>
:ET