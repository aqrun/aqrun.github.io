I"¹9<blockquote>
  <p><a href="/2020/02/02/0.magento-menu.html">Magento 2 å¼€å‘å†…å®¹ç›®å½•</a></p>
</blockquote>

<p>æœ¬æ–‡è®¨è®ºä¸€ä¸‹è·¯ç”±ç³»ç»Ÿï¼ˆRoutingï¼‰ã€‚è·¯ç”±å®šä¹‰ä¼šæŒ‡å®šæ¨¡å—åç§°ï¼Œå¯ç”¨äºæ ¹æ®URLå‚æ•°æ‰¾åˆ°å¯¹åº”æ¨¡å—å¹¶æ‰§è¡Œæ§åˆ¶å™¨æ–¹æ³•</p>

<p>æœ¬æ–‡å†…å®¹ç›®å½•ï¼š</p>

<ul>
  <li>Magento 2 å¤„ç†è¯·æ±‚æµç¨‹</li>
  <li>åœ¨å‰ç«¯æˆ–åå°æ·»åŠ è‡ªå®šä¹‰è·¯ç”±
    <ul>
      <li>å‰ç«¯è·¯ç”±
        <ul>
          <li>routes.xml</li>
        </ul>
      </li>
      <li>åå°è·¯ç”±</li>
      <li>ä½¿ç”¨è·¯ç”±é‡å†™æ§åˆ¶å™¨</li>
    </ul>
  </li>
</ul>

<h2 id="magento-2-è¯·æ±‚å¤„ç†æµç¨‹">Magento 2 è¯·æ±‚å¤„ç†æµç¨‹</h2>

<p>å¦‚ä¸‹URL</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://example.com/index.php/front_name/controller/action
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">front_name</code> å¯ç”¨äºæŸ¥æ‰¾å¯¹åº”çš„æ¨¡å—ã€‚æ¯ä¸ªæ¨¡å—çš„è·¯ç”±å®šä¹‰è¿™ä¸ªåç§°å‚æ•°æ˜¯ä½¿ç”¨ routes.xml é…ç½®æ–‡ä»¶ã€‚åé¢ä¼šè¯¦ç»†è¯´æ˜</p>

<p>Magento 2 æ¥æ”¶åˆ°è¯·æ±‚æ—¶ä¸ºäº†æ‰¾åˆ°å¯¹åº”æ§åˆ¶å™¨/åŠ¨ä½œçš„æµç¨‹æ˜¯ï¼šindex.php -&gt; HTTP app -&gt; FrontController -&gt; Routing -&gt; Controller -&gt; processing -&gt; etc</p>

<p>Http ç±»ä¼šè°ƒç”¨ FrontControler å†é€šè¿‡è¯·æ±‚çš„è·¯ç”±æ‰¾åˆ°åŒ¹é…çš„ æ§åˆ¶å™¨åŠ¨ä½œ</p>

<p>æ–‡ä»¶ï¼š <code class="language-plaintext highlighter-rouge">vendor/magento/framework/App/FrontControler.php</code></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">dispatch</span><span class="p">(</span><span class="kt">RequestInterface</span> <span class="nv">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="err">\</span><span class="nc">Magento\Framework\Profiler</span><span class="o">::</span><span class="nf">start</span><span class="p">(</span><span class="s1">'routes_match'</span><span class="p">);</span>
    <span class="nv">$routingCycleCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">isDispatched</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nv">$routingCycleCounter</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
        <span class="cd">/** @var \Magento\Framework\App\RouterInterface $router  */</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">_routerList</span> <span class="k">as</span> <span class="nv">$router</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span><span class="p">{</span>
                <span class="nv">$actionInstance</span> <span class="o">=</span> <span class="nv">$router</span><span class="o">-&gt;</span><span class="nf">match</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$actionInstance</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">setDispatched</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">response</span><span class="o">-&gt;</span><span class="nf">setNoCacheHeaders</span><span class="p">();</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nv">$actionInstance</span> <span class="k">instanceof</span> <span class="err">\</span><span class="nc">Magento\Framework\App\Action\AbstractAction</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$actionInstance</span><span class="o">-&gt;</span><span class="nf">dispatch</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$actionInstance</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
                    <span class="p">}</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span><span class="k">catch</span> <span class="p">(</span><span class="err">\</span><span class="nc">Magento\Framework\Exception\NotFoundException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">initForward</span><span class="p">();</span>
                    <span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">setActionName</span><span class="p">(</span><span class="s1">'noroute'</span><span class="p">);</span>
                    <span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">setDispatched</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å¦‚ä¸Šä»£ç çš„ dispatch() æ–¹æ³•ä¸­ï¼Œä¼šå¾ªç¯è·¯ç”±åˆ—è¡¨æ¥æŸ¥æ‰¾åŒ¹é…å½“å‰è¯·æ±‚çš„è·¯ç”±ã€‚å¦‚æœæ‰¾åˆ°å½“å‰åŒ¹é…çš„æ§åˆ¶å™¨åŠ¨ä½œå°±ä¼šè°ƒç”¨æ‰§è¡Œã€‚</p>

<h2 id="åœ¨å‰ç«¯æˆ–åå°åˆ›å»ºè‡ªå®šä¹‰è·¯ç”±">åœ¨å‰ç«¯æˆ–åå°åˆ›å»ºè‡ªå®šä¹‰è·¯ç”±</h2>

<p>ç»§ç»­ä½¿ç”¨ HelloWorld æ¨¡å—æ¼”ç¤ºä»£ç ã€‚</p>

<p>æ¥ä¸‹æ¥æ¼”ç¤ºå¦‚ä½•åœ¨å‰ç«¯æˆ–åå°æ·»åŠ è·¯ç”±ä»¥åŠå¦‚ä½•ä½¿ç”¨è·¯ç”±æ”¹å†™æ§åˆ¶å™¨</p>

<h3 id="å‰ç«¯è·¯ç”±">å‰ç«¯è·¯ç”±</h3>

<p>å‰ç«¯è·¯ç”±ä½¿ç”¨é…ç½®æ–‡ä»¶ routes.xml</p>

<p>è·¯å¾„ï¼š <code class="language-plaintext highlighter-rouge">app/code/Aqrun/HelloWorld/etc/frontend/routeds.xml</code></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" ?&gt;</span>
<span class="nt">&lt;config</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">"urn:magento:framework:App/etc/routes.xsd"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- å‰å°è·¯ç”±å¿…é¡»å®šä¹‰åœ¨ 'standard' è·¯ç”±ä¸‹é¢ --&gt;</span>
    <span class="nt">&lt;router</span> <span class="na">id=</span><span class="s">"standard"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!--å®šä¹‰è·¯ç”±å¹¶æŒ‡å®š id å’Œ frontname --&gt;</span>
        <span class="nt">&lt;route</span> <span class="na">frontName=</span><span class="s">"helloworld"</span> <span class="na">id=</span><span class="s">"helloworld"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- è·¯ç”±åŒ¹é…çš„æ¨¡å— --&gt;</span>
            <span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"Aqrun_HelloWorld"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/route&gt;</span>
    <span class="nt">&lt;/router&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</code></pre></div></div>

<p>å¦‚ä¸Šä»£ç æ³¨å†Œè·¯ç”±éå¸¸ç®€å•ã€‚å‰å°è·¯ç”±å¿…é¡»ä½¿ç”¨ standard è·¯ç”±ï¼Œåœ¨è¿™ä¸ªè·¯ç”±ä¸‹é¢å†æ·»åŠ å­é¡¹ï¼ŒæŒ‡å®šæ¨¡å—åŠä¸¤ä¸ªå±æ€§ï¼š</p>

<ul>
  <li>id å±æ€§æ˜¯è·¯ç”±çš„å”¯ä¸€æ ‡è¯†ï¼Œåœ¨ç»™æ¨¡å—æ·»åŠ å¸ƒå±€å¥æŸ„æ–‡ä»¶æ—¶ä¹Ÿä¼šç”¨åˆ°è¿™ä¸ªID</li>
  <li>frontName å±æ€§å€¼ä¹Ÿæ˜¯å”¯ä¸€çš„å­—ç¬¦ä¸²ï¼Œä¼šæ˜¾ç¤ºåœ¨URLè¯·æ±‚çš„é“¾æ¥ä¸­ã€‚æ¯”å¦‚å¦‚ä¸‹è·¯ç”±ï¼š</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;route</span> <span class="na">frontName=</span><span class="s">"helloworld"</span> <span class="na">id=</span><span class="s">"helloworld"</span><span class="nt">&gt;</span>
</code></pre></div></div>

<p>åˆ™å½“å‰æ¨¡å—çš„URLå°±æ˜¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://example.xom/index.php/helloworld/controller/action
</code></pre></div></div>

<p>å¯¹åº”æ§åˆ¶å™¨åŠ¨ä½œçš„å¸ƒå±€å¥æŸ„æ–‡ä»¶å°±æ˜¯ï¼š <code class="language-plaintext highlighter-rouge">helloworld_controller_action.xml</code>, æ ¹æ®ç¤ºä¾‹ä»£ç ä¸­çš„è·¯å¾„åˆ›å»ºå¯¹åº”çš„åŠ¨ä½œç±»ï¼š <code class="language-plaintext highlighter-rouge">{namespace}/{module}/Controller/{Controller}/{Action}.php</code></p>

<h3 id="åå°è·¯ç”±">åå°è·¯ç”±</h3>

<p>åå°è·¯ç”±é…ç½®æ–‡ä»¶å’Œä¸Šé¢çš„å‰å°è·¯ç”±ä¸€æ ·ï¼Œä½†æ–‡ä»¶å¤¹æ˜¯ adminhtml åŠ router èŠ‚ç‚¹çš„IDå¿…é¡»æ˜¯ <code class="language-plaintext highlighter-rouge">admin</code></p>

<p>æ–‡ä»¶ï¼š <code class="language-plaintext highlighter-rouge">app/code/Aqrun/HelloWorld/etc/adminhtml/routes.xml</code></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="nt">&lt;config</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">"urn:magento:framework:App/etc/routes.xsd"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- åå°ä½¿ç”¨ admin è·¯ç”± --&gt;</span>
    <span class="nt">&lt;router</span> <span class="na">id=</span><span class="s">"admin"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- å®šä¹‰è·¯ç”±åŠä¸¤ä¸ªå±æ€§ --&gt;</span>
        <span class="nt">&lt;route</span> <span class="na">id=</span><span class="s">"aqrun_helloworld"</span> <span class="na">frontName=</span><span class="s">"aqrun_helloworld"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- åŒ¹é…çš„æ¨¡å— --&gt;</span>
            <span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"Aqrun_HelloWorld"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/route&gt;</span>
    <span class="nt">&lt;/router&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</code></pre></div></div>

<p>åé¢é¡µé¢URLå’Œå‰å°é¡µé¢ä¸€æ ·ï¼Œä½†ä¼šåœ¨è·¯ç”±åç§°å‰æ·»åŠ åå°èŒƒå›´åæ¥æ ‡è¯†è¿™æ˜¯åå°çš„è·¯ç”±ã€‚å¦‚ä¸‹URL</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://example.xom/index.php/admin/aqrun_helloworld/controller/action
</code></pre></div></div>

<p>åå°é¡µé¢çš„æ§åˆ¶å™¨åŠ¨ä½œçš„ç›®å½•æ˜¯ <code class="language-plaintext highlighter-rouge">Controller/Adminhtml</code>ã€‚ä¸Šé¢çš„URLåŠ¨ä½œæ–‡ä»¶å°±æ˜¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{namespace}/{module}/Controller/Adminhtml/{Controller}/{Action}.php
</code></pre></div></div>

<h3 id="ä½¿ç”¨è·¯ç”±é‡å†™æ§åˆ¶å™¨">ä½¿ç”¨è·¯ç”±é‡å†™æ§åˆ¶å™¨</h3>

<p>æ¥ä¸‹æ¥ç ”ç©¶ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨è·¯ç”±å®ç°æ§åˆ¶å™¨é‡å†™ã€‚æ ¹æ®ä¸Šé¢çš„å†…å®¹ï¼Œå¯ä»¥çœ‹å‡ºæ¯ä¸ªè·¯ç”±éƒ½æœ‰IDå±æ€§æ ‡è¯†ã€‚é‚£å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸€æ ·çš„IDå±æ€§å®šä¹‰ä¸¤ä¸ªè·¯ç”±ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p>

<p>ç­”æ¡ˆå°±æ˜¯åŒ¹é…ä¸¤ä¸ªæ¨¡å—ä¸­çš„æ§åˆ¶å™¨åŠ¨ä½œã€‚Magento ç³»ç»Ÿæä¾›äº† before/after å±æ€§æ¥é…ç½®æ¨¡å—çš„æ’åºï¼Œç”¨æ¥æŒ‡å®šå“ªä¸ªæ¨¡å—çš„æ§åˆ¶å™¨å…ˆè¢«å‘ç°ã€‚è¿™å°±æ˜¯æ§åˆ¶å™¨é‡å†™çš„é€»è¾‘ã€‚</p>

<p>æ¯”å¦‚æˆ‘ä»¬è¦é‡å†™æ§åˆ¶å™¨ <code class="language-plaintext highlighter-rouge">customer/account/login</code>ï¼Œæˆ‘ä»¬ä¼šåœ¨ routes.xml å¦‚ä¸‹å®šä¹‰</p>

<p>æ–‡ä»¶ï¼š <code class="language-plaintext highlighter-rouge">app/code/Aqrun/HelloWorld/etc/frontend/routnes.xml</code></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="nt">&lt;config</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">"urn:magento:framework:App/etc/routes.xsd"</span><span class="nt">&gt;</span>
   <span class="c">&lt;!-- å‰å°ä½¿ç”¨ 'standard'--&gt;</span>
   <span class="nt">&lt;router</span> <span class="na">id=</span><span class="s">"standard"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!--å®šä¹‰è·¯ç”±--&gt;</span>
        <span class="nt">&lt;route</span> <span class="na">frontName=</span><span class="s">"helloworld"</span> <span class="na">id=</span><span class="s">"helloworld"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!--æŒ‡å®šæ¨¡å—--&gt;</span>
            <span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"Aqrun_HelloWorld"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/route&gt;</span>
       <span class="nt">&lt;route</span> <span class="na">id=</span><span class="s">"customer"</span><span class="nt">&gt;</span>
           <span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"Aqrun_HelloWorld"</span> <span class="na">before=</span><span class="s">"Magento_Customer"</span> <span class="nt">/&gt;</span>
       <span class="nt">&lt;/route&gt;</span>
   <span class="nt">&lt;/router&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</code></pre></div></div>

<p>å¯¹åº”çš„æ§åˆ¶å™¨æ–‡ä»¶ï¼š <code class="language-plaintext highlighter-rouge">app/code/Aqrun/HelloWorld/Controler/Account/Login.php</code></p>

<p>å› æ­¤ frontControler ç±»ä¼šå…ˆåŒ¹é…åˆ°æˆ‘ä»¬çš„æ¨¡å—ä¸­çš„ Login åŠ¨ä½œï¼Œå¦‚æœåŒ¹é…åˆ°äº†å°±ä¼šæ‰§è¡Œæˆ‘ä»¬çš„åŠ¨ä½œè€Œ Magneto_Customer æ¨¡å—çš„åŠ¨ä½œä¸ä¼šå†æ‰§è¡Œã€‚è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†æ§åˆ¶çš„é‡å†™ã€‚</p>

<p>ä½ ä¹Ÿå¯ä»¥åœ¨æ¨¡å—ä¸­ä½¿ç”¨å’Œå…¶å®ƒæ¨¡å—ä¸€æ ·çš„è·¯ç”±ç›¸å½“äºé…ç½®äº†å¦ä¸€ä¸ªæ¨¡å—ã€‚æ¯”å¦‚ä¸Šé¢çš„é…ç½®æ–‡ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ customer è·¯ç”±è°ƒç”¨ä½ çš„æ§åˆ¶å™¨å’ŒåŠ¨ä½œã€‚å¦‚æœæ§åˆ¶å™¨æ˜¯ â€˜Blogâ€™ åŠ¨ä½œæ˜¯ â€˜Index.phpâ€™, é‚£è®¿é—®çš„URLå°±æ˜¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://example.xom/customer/blog/index
</code></pre></div></div>

:ET