<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <script src="https://aqrun.com/theme.min.js" integrity="sha384-IpIaa84kOKgkF5EJ0fD/kBe2wtIIsIB60ANGmuJxeA0dz5bSRfwBwp2/QybtQpU2"></script>
  <link rel="stylesheet" href="https://aqrun.com/abridge-switcher.css?h=2973f26bcd9308b43249" />
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <script defer src="https://aqrun.com/abridge-bundle.min.js?h=f0e7958f46d06221e99d" integrity="sha384-nUzn1rJBMPtXHTJcP76DAl7M3pn9hUVGWBMq6iYleX0NZ/ec+/xQ6nl8iXbBLfCs"></script>
  <meta name="base" content="https://aqrun.com" />
  <link rel="alternate" type="application/atom+xml" title="Atom/RSS Feed" href="https://aqrun.com/atom.xml" />
  <meta name="robots" content="index, follow" />
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <title>13.Magento2 路由 | 光鹿跑冰</title>
  <meta name="author" content="子十" />
  <meta name="copyright" content="光鹿跑冰" />
  <meta name="description" content="路由定义会指定模块名称，可用于根据URL参数找到对应模块并执行控制器方法" />
  <link rel="canonical" href="https://aqrun.com/backend/13-magento-2-routing/" />
  <meta name="keywords" content="子十,Aqrun, Zola, Theme, Zola Theme, getzola" />
  <meta property="og:url" content="https://aqrun.com/backend/13-magento-2-routing/" />
  <meta name="twitter:url" content="https://aqrun.com/backend/13-magento-2-routing/" />
  <meta property="og:description" content="路由定义会指定模块名称，可用于根据URL参数找到对应模块并执行控制器方法" />
  <meta name="twitter:description" content="路由定义会指定模块名称，可用于根据URL参数找到对应模块并执行控制器方法" />
  <meta property="og:title" content="13.Magento2 路由 | 光鹿跑冰" />
  <meta name="twitter:title" content="13.Magento2 路由 | 光鹿跑冰" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="https://aqrun.com/banner.png" />
  <meta property="og:image" content="https://aqrun.com/banner.png" />
  <meta property="og:site_name" content="光鹿跑冰" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="website" />
  <meta property="og:updated_time" content="2019-11-18" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="theme-color" content="#333333" />
  <meta name="msapplication-TileColor" content="#333333" />
  <link rel="manifest" href="https://aqrun.com/site.webmanifest" />
  <link rel="mask-icon" href="https://aqrun.com/safari-pinned-tab.svg" color="#ff9900" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://aqrun.com/favicon.ico" />
  <link rel="icon" type="image/png" sizes="32x32" href="https://aqrun.com/favicon.ico" />
  <link rel="icon" type="image/png" sizes="16x16" href="https://aqrun.com/favicon.ico" />
  <noscript><link rel="stylesheet" href="https://aqrun.com/nojs.css" /></noscript><noscript>
    <div id="wx_pic" style="margin:0 auto;display:none;"><img src="https://static.oicnp.com/blog/pic300.jpg" />
    </div>
</noscript></head>
<body>
  <header>
    <nav>
      <div><h1 class="oic-header-logfile">
            <a
               href="https://aqrun.com/"
               title="子十个人博客"
            ><img src="https://aqrun.com/icons/logo_default.svg" alt="光鹿跑冰" width="22" height="22" />光鹿跑冰</a>
          </h1></div>
      <div>
        <ul><li> <h2><a href="https://aqrun.com/">首页</a></h2> </li><li> <h2><a href="https://aqrun.com/posts/">全部内容</a></h2> </li><li> <h2><a href="https://aqrun.com/categories/">分类</a></h2> </li><li> <h2><a href="https://aqrun.com/tags/">标签</a></h2> </li><li> <h2><a href="https://aqrun.com/diary/">每日随笔</a></h2> </li><li class="js"><i type="reset" id="mode" class="svgs adjust"></i></li></ul>
      </div>
      <div>
        <form autocomplete=off class="js" name="goSearch" id="searchbox">
          <div class="searchd">
            <input id="searchinput" type="text" placeholder="内容搜索" title="Search" />
            <button type="submit" title="Search"><i class="svgs search"></i></button>
          </div>
          <div><div id="suggestions"></div></div>
        </form>
      </div>
    </nav>
  </header>
  <main>
    <article class="oic-page">
        <h1><a href="https://aqrun.com/backend/13-magento-2-routing/">13.Magento2 路由</a></h1>
        <span class="s95"> 子十<span class="hpad"> </span> 2019-11-18<span class="hpad"> </span>
          [<a href="https://aqrun.com/categories/backend/">
                后端开发
            </a>]
           #<a href="https://aqrun.com/tags/php/">php</a>  #<a href="https://aqrun.com/tags/magento2/">magento2</a> </span>

    <blockquote>
<p><a href="https://aqrun.com/backend/0-magento-menu/">Magento 2 开发内容目录</a></p>
</blockquote>
<p>本文讨论一下路由系统（Routing）。路由定义会指定模块名称，可用于根据URL参数找到对应模块并执行控制器方法</p>
<p>本文内容目录：</p>
<ul>
<li>Magento 2 处理请求流程</li>
<li>在前端或后台添加自定义路由
<ul>
<li>前端路由
<ul>
<li>routes.xml</li>
</ul>
</li>
<li>后台路由</li>
<li>使用路由重写控制器</li>
</ul>
</li>
</ul>
<h2 id="magento-2-qing-qiu-chu-li-liu-cheng">Magento 2 请求处理流程</h2>
<p>如下URL</p>
<pre class="z-code"><code><span class="z-text z-plain">http://example.com/index.php/front_name/controller/action
</span></code></pre>
<p><code>front_name</code> 可用于查找对应的模块。每个模块的路由定义这个名称参数是使用 routes.xml 配置文件。后面会详细说明</p>
<p>Magento 2 接收到请求时为了找到对应控制器/动作的流程是：index.php -&gt; HTTP app -&gt; FrontController -&gt; Routing -&gt; Controller -&gt; processing -&gt; etc</p>
<p>Http 类会调用 FrontControler 再通过请求的路由找到匹配的 控制器动作</p>
<p>文件： <code>vendor/magento/framework/App/FrontControler.php</code></p>
<pre data-lang="php" class="language-php z-code"><code class="language-php" data-lang="php"><span class="z-embedding z-php"><span class="z-text z-html z-basic">public function dispatch(RequestInterface $request)
{
    \Magento\Framework\Profiler::start(&#39;routes_match&#39;);
    $routingCycleCounter = 0;
    $result = null;
    while (!$request-&gt;isDispatched() &amp;&amp; $routingCycleCounter++ &lt; 100) {
        /** @var \Magento\Framework\App\RouterInterface $router  */
        foreach($this-&gt;_routerList as $router) {
            try{
                $actionInstance = $router-&gt;match($request);
                if($actionInstance) {
                    $request-&gt;setDispatched(true);
                    $this-&gt;response-&gt;setNoCacheHeaders();
                    if ($actionInstance instanceof \Magento\Framework\App\Action\AbstractAction) {
                        $result = $actionInstance-&gt;dispatch($request);
                    } else {
                        $result = $actionInstance-&gt;execute();
                    }
                    break;
                }catch (\Magento\Framework\Exception\NotFoundException $e) {
                    $request-&gt;initForward();
                    $request-&gt;setActionName(&#39;noroute&#39;);
                    $request-&gt;setDispatched(false);
                    break;
                }
            }
        }
    }
}
</span></span></code></pre>
<p>如上代码的 dispatch() 方法中，会循环路由列表来查找匹配当前请求的路由。如果找到当前匹配的控制器动作就会调用执行。</p>
<h2 id="zai-qian-duan-huo-hou-tai-chuang-jian-zi-ding-yi-lu-you">在前端或后台创建自定义路由</h2>
<p>继续使用 HelloWorld 模块演示代码。</p>
<p>接下来演示如何在前端或后台添加路由以及如何使用路由改写控制器</p>
<h3 id="qian-duan-lu-you">前端路由</h3>
<p>前端路由使用配置文件 routes.xml</p>
<p>路径： <code>app/code/Aqrun/HelloWorld/etc/frontend/routeds.xml</code></p>
<pre data-lang="xml" class="language-xml z-code"><code class="language-xml" data-lang="xml"><span class="z-text z-xml"><span class="z-meta z-tag z-preprocessor z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;?</span><span class="z-entity z-name z-tag z-xml">xml</span> <span class="z-entity z-other z-attribute-name z-localname z-xml">version</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>1.0<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span> <span class="z-punctuation z-definition z-tag z-end z-xml">?&gt;</span></span>
<span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;</span><span class="z-entity z-name z-tag z-localname z-xml">config</span> <span class="z-entity z-other z-attribute-name z-namespace z-xml">xmlns</span><span class="z-entity z-other z-attribute-name z-xml"><span class="z-punctuation z-separator z-namespace z-xml">:</span></span><span class="z-entity z-other z-attribute-name z-localname z-xml">xsi</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span> <span class="z-entity z-other z-attribute-name z-namespace z-xml">xsi</span><span class="z-entity z-other z-attribute-name z-xml"><span class="z-punctuation z-separator z-namespace z-xml">:</span></span><span class="z-entity z-other z-attribute-name z-localname z-xml">noNamespaceSchemaLocation</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>urn:magento:framework:App/etc/routes.xsd<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
    <span class="z-comment z-block z-xml"><span class="z-punctuation z-definition z-comment z-begin z-xml">&lt;!--</span> 前台路由必须定义在 &#39;standard&#39; 路由下面 <span class="z-punctuation z-definition z-comment z-end z-xml">--&gt;</span></span>
    <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;</span><span class="z-entity z-name z-tag z-localname z-xml">router</span> <span class="z-entity z-other z-attribute-name z-localname z-xml">id</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>standard<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
        <span class="z-comment z-block z-xml"><span class="z-punctuation z-definition z-comment z-begin z-xml">&lt;!--</span>定义路由并指定 id 和 frontname <span class="z-punctuation z-definition z-comment z-end z-xml">--&gt;</span></span>
        <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;</span><span class="z-entity z-name z-tag z-localname z-xml">route</span> <span class="z-entity z-other z-attribute-name z-localname z-xml">frontName</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>helloworld<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span> <span class="z-entity z-other z-attribute-name z-localname z-xml">id</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>helloworld<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
            <span class="z-comment z-block z-xml"><span class="z-punctuation z-definition z-comment z-begin z-xml">&lt;!--</span> 路由匹配的模块 <span class="z-punctuation z-definition z-comment z-end z-xml">--&gt;</span></span>
            <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;</span><span class="z-entity z-name z-tag z-localname z-xml">module</span> <span class="z-entity z-other z-attribute-name z-localname z-xml">name</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>Aqrun_HelloWorld<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span><span class="z-punctuation z-definition z-tag z-end z-xml">/&gt;</span></span>
        <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;/</span><span class="z-entity z-name z-tag z-localname z-xml">route</span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
    <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;/</span><span class="z-entity z-name z-tag z-localname z-xml">router</span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
<span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;/</span><span class="z-entity z-name z-tag z-localname z-xml">config</span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
</span></code></pre>
<p>如上代码注册路由非常简单。前台路由必须使用 standard 路由，在这个路由下面再添加子项，指定模块及两个属性：</p>
<ul>
<li>id 属性是路由的唯一标识，在给模块添加布局句柄文件时也会用到这个ID</li>
<li>frontName 属性值也是唯一的字符串，会显示在URL请求的链接中。比如如下路由：</li>
</ul>
<pre data-lang="xml" class="language-xml z-code"><code class="language-xml" data-lang="xml"><span class="z-text z-xml"><span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;</span><span class="z-entity z-name z-tag z-localname z-xml">route</span> <span class="z-entity z-other z-attribute-name z-localname z-xml">frontName</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>helloworld<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span> <span class="z-entity z-other z-attribute-name z-localname z-xml">id</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>helloworld<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
</span></code></pre>
<p>则当前模块的URL就是：</p>
<pre class="z-code"><code><span class="z-text z-plain">http://example.xom/index.php/helloworld/controller/action
</span></code></pre>
<p>对应控制器动作的布局句柄文件就是： <code>helloworld_controller_action.xml</code>, 根据示例代码中的路径创建对应的动作类： <code>{namespace}/{module}/Controller/{Controller}/{Action}.php</code></p>
<h3 id="hou-tai-lu-you">后台路由</h3>
<p>后台路由配置文件和上面的前台路由一样，但文件夹是 adminhtml 及 router 节点的ID必须是 <code>admin</code></p>
<p>文件： <code>app/code/Aqrun/HelloWorld/etc/adminhtml/routes.xml</code></p>
<pre data-lang="xml" class="language-xml z-code"><code class="language-xml" data-lang="xml"><span class="z-text z-xml"><span class="z-meta z-tag z-preprocessor z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;?</span><span class="z-entity z-name z-tag z-xml">xml</span> <span class="z-entity z-other z-attribute-name z-localname z-xml">version</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>1.0<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span><span class="z-punctuation z-definition z-tag z-end z-xml">?&gt;</span></span>
<span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;</span><span class="z-entity z-name z-tag z-localname z-xml">config</span> <span class="z-entity z-other z-attribute-name z-namespace z-xml">xmlns</span><span class="z-entity z-other z-attribute-name z-xml"><span class="z-punctuation z-separator z-namespace z-xml">:</span></span><span class="z-entity z-other z-attribute-name z-localname z-xml">xsi</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span> <span class="z-entity z-other z-attribute-name z-namespace z-xml">xsi</span><span class="z-entity z-other z-attribute-name z-xml"><span class="z-punctuation z-separator z-namespace z-xml">:</span></span><span class="z-entity z-other z-attribute-name z-localname z-xml">noNamespaceSchemaLocation</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>urn:magento:framework:App/etc/routes.xsd<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
    <span class="z-comment z-block z-xml"><span class="z-punctuation z-definition z-comment z-begin z-xml">&lt;!--</span> 后台使用 admin 路由 <span class="z-punctuation z-definition z-comment z-end z-xml">--&gt;</span></span>
    <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;</span><span class="z-entity z-name z-tag z-localname z-xml">router</span> <span class="z-entity z-other z-attribute-name z-localname z-xml">id</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>admin<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
        <span class="z-comment z-block z-xml"><span class="z-punctuation z-definition z-comment z-begin z-xml">&lt;!--</span> 定义路由及两个属性 <span class="z-punctuation z-definition z-comment z-end z-xml">--&gt;</span></span>
        <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;</span><span class="z-entity z-name z-tag z-localname z-xml">route</span> <span class="z-entity z-other z-attribute-name z-localname z-xml">id</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>aqrun_helloworld<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span> <span class="z-entity z-other z-attribute-name z-localname z-xml">frontName</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>aqrun_helloworld<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
            <span class="z-comment z-block z-xml"><span class="z-punctuation z-definition z-comment z-begin z-xml">&lt;!--</span> 匹配的模块 <span class="z-punctuation z-definition z-comment z-end z-xml">--&gt;</span></span>
            <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;</span><span class="z-entity z-name z-tag z-localname z-xml">module</span> <span class="z-entity z-other z-attribute-name z-localname z-xml">name</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>Aqrun_HelloWorld<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span><span class="z-punctuation z-definition z-tag z-end z-xml">/&gt;</span></span>
        <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;/</span><span class="z-entity z-name z-tag z-localname z-xml">route</span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
    <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;/</span><span class="z-entity z-name z-tag z-localname z-xml">router</span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
<span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;/</span><span class="z-entity z-name z-tag z-localname z-xml">config</span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
</span></code></pre>
<p>后面页面URL和前台页面一样，但会在路由名称前添加后台范围名来标识这是后台的路由。如下URL</p>
<pre class="z-code"><code><span class="z-text z-plain">http://example.xom/index.php/admin/aqrun_helloworld/controller/action
</span></code></pre>
<p>后台页面的控制器动作的目录是 <code>Controller/Adminhtml</code>。上面的URL动作文件就是：</p>
<pre class="z-code"><code><span class="z-text z-plain">{namespace}/{module}/Controller/Adminhtml/{Controller}/{Action}.php
</span></code></pre>
<h3 id="shi-yong-lu-you-zhong-xie-kong-zhi-qi">使用路由重写控制器</h3>
<p>接下来研究一下如何使用路由实现控制器重写。根据上面的内容，可以看出每个路由都有ID属性标识。那如果我们使用一样的ID属性定义两个路由会发生什么呢？</p>
<p>答案就是匹配两个模块中的控制器动作。Magento 系统提供了 before/after 属性来配置模块的排序，用来指定哪个模块的控制器先被发现。这就是控制器重写的逻辑。</p>
<p>比如我们要重写控制器 <code>customer/account/login</code>，我们会在 routes.xml 如下定义</p>
<p>文件： <code>app/code/Aqrun/HelloWorld/etc/frontend/routnes.xml</code></p>
<pre data-lang="xml" class="language-xml z-code"><code class="language-xml" data-lang="xml"><span class="z-text z-xml"><span class="z-meta z-tag z-preprocessor z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;?</span><span class="z-entity z-name z-tag z-xml">xml</span> <span class="z-entity z-other z-attribute-name z-localname z-xml">version</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>1.0<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span><span class="z-punctuation z-definition z-tag z-end z-xml">?&gt;</span></span>
<span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;</span><span class="z-entity z-name z-tag z-localname z-xml">config</span> <span class="z-entity z-other z-attribute-name z-namespace z-xml">xmlns</span><span class="z-entity z-other z-attribute-name z-xml"><span class="z-punctuation z-separator z-namespace z-xml">:</span></span><span class="z-entity z-other z-attribute-name z-localname z-xml">xsi</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span> <span class="z-entity z-other z-attribute-name z-namespace z-xml">xsi</span><span class="z-entity z-other z-attribute-name z-xml"><span class="z-punctuation z-separator z-namespace z-xml">:</span></span><span class="z-entity z-other z-attribute-name z-localname z-xml">noNamespaceSchemaLocation</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>urn:magento:framework:App/etc/routes.xsd<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
   <span class="z-comment z-block z-xml"><span class="z-punctuation z-definition z-comment z-begin z-xml">&lt;!--</span> 前台使用 &#39;standard&#39;<span class="z-punctuation z-definition z-comment z-end z-xml">--&gt;</span></span>
   <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;</span><span class="z-entity z-name z-tag z-localname z-xml">router</span> <span class="z-entity z-other z-attribute-name z-localname z-xml">id</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>standard<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
        <span class="z-comment z-block z-xml"><span class="z-punctuation z-definition z-comment z-begin z-xml">&lt;!--</span>定义路由<span class="z-punctuation z-definition z-comment z-end z-xml">--&gt;</span></span>
        <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;</span><span class="z-entity z-name z-tag z-localname z-xml">route</span> <span class="z-entity z-other z-attribute-name z-localname z-xml">frontName</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>helloworld<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span> <span class="z-entity z-other z-attribute-name z-localname z-xml">id</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>helloworld<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
            <span class="z-comment z-block z-xml"><span class="z-punctuation z-definition z-comment z-begin z-xml">&lt;!--</span>指定模块<span class="z-punctuation z-definition z-comment z-end z-xml">--&gt;</span></span>
            <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;</span><span class="z-entity z-name z-tag z-localname z-xml">module</span> <span class="z-entity z-other z-attribute-name z-localname z-xml">name</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>Aqrun_HelloWorld<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span><span class="z-punctuation z-definition z-tag z-end z-xml">/&gt;</span></span>
        <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;/</span><span class="z-entity z-name z-tag z-localname z-xml">route</span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
       <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;</span><span class="z-entity z-name z-tag z-localname z-xml">route</span> <span class="z-entity z-other z-attribute-name z-localname z-xml">id</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>customer<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
           <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;</span><span class="z-entity z-name z-tag z-localname z-xml">module</span> <span class="z-entity z-other z-attribute-name z-localname z-xml">name</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>Aqrun_HelloWorld<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span> <span class="z-entity z-other z-attribute-name z-localname z-xml">before</span><span class="z-punctuation z-separator z-key-value z-xml">=</span><span class="z-string z-quoted z-double z-xml"><span class="z-punctuation z-definition z-string z-begin z-xml">&quot;</span>Magento_Customer<span class="z-punctuation z-definition z-string z-end z-xml">&quot;</span></span> <span class="z-punctuation z-definition z-tag z-end z-xml">/&gt;</span></span>
       <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;/</span><span class="z-entity z-name z-tag z-localname z-xml">route</span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
   <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;/</span><span class="z-entity z-name z-tag z-localname z-xml">router</span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
<span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&lt;/</span><span class="z-entity z-name z-tag z-localname z-xml">config</span><span class="z-punctuation z-definition z-tag z-end z-xml">&gt;</span></span>
</span></code></pre>
<p>对应的控制器文件： <code>app/code/Aqrun/HelloWorld/Controler/Account/Login.php</code></p>
<p>因此 frontControler 类会先匹配到我们的模块中的 Login 动作，如果匹配到了就会执行我们的动作而 Magneto_Customer 模块的动作不会再执行。这样我们就完成了控制的重写。</p>
<p>你也可以在模块中使用和其它模块一样的路由相当于配置了另一个模块。比如上面的配置文件，你可以使用 customer 路由调用你的控制器和动作。如果控制器是 'Blog' 动作是 'Index.php', 那访问的URL就是：</p>
<pre class="z-code"><code><span class="z-text z-plain">http://example.xom/customer/blog/index
</span></code></pre>

<p><b><a href="#">返回顶部</a></b></p>
    </article>
    <div class="toc" aria-hidden="true">
      <div class="toc-sticky">
        <h3>目录</h3>
        <div class="toc-item">
          <a class="subtext" href="https://aqrun.com/backend/13-magento-2-routing/#magento-2-qing-qiu-chu-li-liu-cheng">Magento 2 请求处理流程</a>
        </div>
        <div class="toc-item">
          <a class="subtext" href="https://aqrun.com/backend/13-magento-2-routing/#zai-qian-duan-huo-hou-tai-chuang-jian-zi-ding-yi-lu-you">在前端或后台创建自定义路由</a>
        </div>
        <div class="toc-item-child">
          <a class="subtext" href="https://aqrun.com/backend/13-magento-2-routing/#qian-duan-lu-you"><small>- 前端路由</small></a>
        </div>
        <div class="toc-item-child">
          <a class="subtext" href="https://aqrun.com/backend/13-magento-2-routing/#hou-tai-lu-you"><small>- 后台路由</small></a>
        </div>
        <div class="toc-item-child">
          <a class="subtext" href="https://aqrun.com/backend/13-magento-2-routing/#shi-yong-lu-you-zhong-xie-kong-zhi-qi"><small>- 使用路由重写控制器</small></a>
        </div>
      </div>
    </div>
  </main>
  <footer>
    <hr />
    <div class="c">
      <nav>
        <ul><li><a href="https://aqrun.com/atom.xml" target="_blank" title="Atom/RSS Feed"><i type="Button" class="svg rss" title="Atom/RSS Feed"></i></a></li><li class="js"><a class="m-protected" href="#YXFydW5Ac2luYS5jb20=" target="_blank" title="Mail"><i type="Button" class="svg mail" title="Mail"></i></a></li><li><a href="https://github.com/aqrun/" target="_blank" title="Github"><i type="Button" class="svg github" title="Github"></i></a></li></ul>
      </nav>
      <p class="s90">Copyright &copy; 2014-2023 光鹿跑冰</p>
      <nav>
        <ul><li class="s90"> <a href="https://aqrun.com/about/"> 关于我 </a> </li><li class="s90"> <a href="https://aqrun.com/contact/"> 联系我 </a> </li><li class="s90"> <a href="https://aqrun.com/privacy/"> 保护权益 </a> </li><li class="s90"> <a href="https://aqrun.com/sitemap.xml" target="_blank"> 网站地图 </a> </li></ul>
      </nav>
      <p class="s90">Powered by <a href="https://www.getzola.org/" target="_blank">Zola</a> 和 <a href="https://github.com/jieiku/abridge/" target="_blank">Abridge</a></p>
    </div>
  </footer>
<span class="topout">
    <span class="topleft"> </span>
    <a href="#" class="top" title="Back to Top">
        <i class="svgs svgh angu"></i>
    </a>
</span>
</body>
</html>