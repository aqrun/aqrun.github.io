<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <script src="https://aqrun.com/theme.min.js" integrity="sha384-IpIaa84kOKgkF5EJ0fD/kBe2wtIIsIB60ANGmuJxeA0dz5bSRfwBwp2/QybtQpU2"></script>
  <link rel="stylesheet" href="https://aqrun.com/abridge-switcher.css?h=2973f26bcd9308b43249" />
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <script defer src="https://aqrun.com/abridge-bundle.min.js?h=f0e7958f46d06221e99d" integrity="sha384-nUzn1rJBMPtXHTJcP76DAl7M3pn9hUVGWBMq6iYleX0NZ/ec+/xQ6nl8iXbBLfCs"></script>
  <meta name="base" content="https://aqrun.com" />
  <link rel="alternate" type="application/atom+xml" title="Atom/RSS Feed" href="https://aqrun.com/atom.xml" />
  <meta name="robots" content="index, follow" />
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <title>Drupal 7 在 nginx服务器 子目录及虚拟机访问时配置伪静态 | 光鹿跑冰</title>
  <meta name="author" content="子十" />
  <meta name="copyright" content="光鹿跑冰" />
  <meta name="description" content="子十个人博客" />
  <link rel="canonical" href="https://aqrun.com/backend/drupal-7-zai-nginxfu-wu-qi-zi-mu-lu-ji-xu-ni-ji-fang-wen-shi-pei-zhi-wei-jing-tai/" />
  <meta name="keywords" content="子十,Aqrun, Zola, Theme, Zola Theme, getzola" />
  <meta property="og:url" content="https://aqrun.com/backend/drupal-7-zai-nginxfu-wu-qi-zi-mu-lu-ji-xu-ni-ji-fang-wen-shi-pei-zhi-wei-jing-tai/" />
  <meta name="twitter:url" content="https://aqrun.com/backend/drupal-7-zai-nginxfu-wu-qi-zi-mu-lu-ji-xu-ni-ji-fang-wen-shi-pei-zhi-wei-jing-tai/" />
  <meta property="og:description" content="子十个人博客" />
  <meta name="twitter:description" content="子十个人博客" />
  <meta property="og:title" content="Drupal 7 在 nginx服务器 子目录及虚拟机访问时配置伪静态 | 光鹿跑冰" />
  <meta name="twitter:title" content="Drupal 7 在 nginx服务器 子目录及虚拟机访问时配置伪静态 | 光鹿跑冰" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="https://aqrun.com/banner.png" />
  <meta property="og:image" content="https://aqrun.com/banner.png" />
  <meta property="og:site_name" content="光鹿跑冰" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="website" />
  <meta property="og:updated_time" content="2016-06-22" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="theme-color" content="#333333" />
  <meta name="msapplication-TileColor" content="#333333" />
  <link rel="manifest" href="https://aqrun.com/site.webmanifest" />
  <link rel="mask-icon" href="https://aqrun.com/safari-pinned-tab.svg" color="#ff9900" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://aqrun.com/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="https://aqrun.com/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="https://aqrun.com/favicon-16x16.png" />
  <noscript><link rel="stylesheet" href="https://aqrun.com/nojs.css" /></noscript>
</head>
<body>
  <header>
    <nav>
      <div><h1 class="oic-header-logfile">
            <a
               href="https://aqrun.com/"
               title="子十个人博客"
            ><img src="https://aqrun.com/icons/logo_default.svg" alt="光鹿跑冰" width="22" height="22" />光鹿跑冰</a>
          </h1></div>
      <div>
        <ul><li> <h2><a href="https://aqrun.com/">首页</a></h2> </li><li> <h2><a href="https://aqrun.com/posts/">全部内容</a></h2> </li><li> <h2><a href="https://aqrun.com/categories/">分类</a></h2> </li><li> <h2><a href="https://aqrun.com/tags/">标签</a></h2> </li><li> <h2><a href="https://aqrun.com/diary/">每日随笔</a></h2> </li><li class="js"><i type="reset" id="mode" class="svgs adjust"></i></li></ul>
      </div>
      <div>
        <form autocomplete=off class="js" name="goSearch" id="searchbox">
          <div class="searchd">
            <input id="searchinput" type="text" placeholder="内容搜索" title="Search" />
            <button type="submit" title="Search"><i class="svgs search"></i></button>
          </div>
          <div><div id="suggestions"></div></div>
        </form>
      </div>
    </nav>
  </header>
  <main>
    <article class="oic-page">
        <h1><a href="https://aqrun.com/backend/drupal-7-zai-nginxfu-wu-qi-zi-mu-lu-ji-xu-ni-ji-fang-wen-shi-pei-zhi-wei-jing-tai/">Drupal 7 在 nginx服务器 子目录及虚拟机访问时配置伪静态</a></h1>
        <span class="s95"> 子十<span class="hpad"> </span> 2016-06-22<span class="hpad"> </span>
          [<a href="https://aqrun.com/categories/backend/">
                后端开发
            </a>]
           #<a href="https://aqrun.com/tags/nginx/">nginx</a>  #<a href="https://aqrun.com/tags/drupal7/">drupal7</a> </span>

    <h2 id="wen-jian-mu-lu-jie-gou">文件目录结构：</h2>
<pre class="z-code"><code><span class="z-text z-plain">/nginx
/nginx/conf
/nginx/conf/nginx.conf         #默认nginx配置文件
/nginx/conf/vhost
/nginx/conf/vhost/localhost.conf    #
/nginx/conf/vhost/*.conf       #各虚拟主机配置文件
</span></code></pre>
<p>以下列出三个主要配置文件内容：</p>
<pre class="line-numbers">
    <code class="language-nginx">
    #＝＝＝＝＝＝＝＝＝＝＝＝＝
    #默认配置文件
    #nginx.conf
    #user  nobody;
    worker_processes  1;
    #error_log  logs/error.log;
    #error_log  logs/error.log  notice;
    #error_log  logs/error.log  info;
    #pid        logs/nginx.pid;
    events {
        worker_connections  1024;
    }
    http {
        include       mime.types;
        default_type  application/octet-stream;
        autoindex        on;
        sendfile        on;
        keepalive_timeout  65;
        include tools-*.conf;  #引入各种配置文件
        include vhost/*.conf; 
    }
    #==============================

    #========================
    #默认访问控制
    #localhost.conf
    server {
        listen 80; # IPv4
        server_name localhost;
        ## Parameterization using hostname of access and log filenames.
        access_log logs/localhost_access.log;
        error_log logs/localhost_error.log;
        ## Root and index files.
        root D:/xampp/htdocs;
        index  index.php index.html index.htm;
        ## If no favicon exists return a 204 (no content error).
        location = /favicon.ico {
            try_files $uri =204;
            log_not_found off;
            access_log off;
        }
        ## Don't log robots.txt requests.
        location = /robots.txt {
            allow all;
            log_not_found off;
            access_log off;
        }
        ## Try the requested URI as files before handling it to PHP.
            location / {
        
            } # / location

            ## Regular PHP processing.
            location ~ \.php$ {
                try_files  $uri =404;
                fastcgi_pass   127.0.0.1:9000;
                fastcgi_index  index.php;
                fastcgi_param  SCRIPT_FILENAME    $document_root$fastcgi_script_name;
                include        fastcgi_params;
            }

            ## Static files
            location ~* \.(?:css|gif|htc|ico|js|jpe?g|png|swf)$ {
                expires max;
                log_not_found off;
                ## No need to bleed constant updates. Send the all shebang in one
                ## fell swoop.
                tcp_nodelay off;
                ## Set the OS file cache.
                open_file_cache max=1000 inactive=120s;
                open_file_cache_valid 45s;
                open_file_cache_min_uses 2;
                open_file_cache_errors off;
            }

            ## Keep a tab on the 'big' static files.
            location ~* ^.+\.(?:ogg|pdf|pptx?)$ {
                expires 30d;
                ## No need to bleed constant updates. Send the all shebang in one
                ## fell swoop.
                tcp_nodelay off;
            }
            #子目录访问 rewrite方式   
            #   http://localhost/drupal/user         会rewrite到       http://localhost/drupal/index.php?q=user
            location /drupal{
                    #使用“-f”和“!-f”运算符检查文件是否存在
                    #使用“-d”和“!-d”运算符检查目录是否存在
                if (!-f $request_filename) {
                    rewrite  ^/drupal/(.*)$  /drupal/index.php?q=$1  last;
                    break;
                }
                if (!-d $request_filename) {
                    rewrite  ^/drupal/(.*)$  /drupal/index.php?q=$1  last;
                    break;
                }
            }
    } # end http server
    #==================================


    #===================================
    #  www.drupal.my    虚拟跟径指向  localhost/drupal
    #www.drupal.my.conf
    server {
        listen   80; ## listen for ipv4; this line is default and implied

        root D:/xampp/htdocs/drupal;
        index index.html index.php;

        server_name www.drupal.my;
        location / {
                index  index.php index.html;
                #rewrite
                # 使用“-e”和“!-e”运算符检查文件、目录或符号链接是否存在；
                if (!-e $request_filename) {
                    rewrite ^/(.*)$ /index.php?q=$1 last;
                }
            }
        
        error_page 404 /404.php;

        location ~ \.php$ {
            try_files  $uri =404;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME    $document_root$fastcgi_script_name;
            include        fastcgi_params;
        }
        #rewrite rules
        #include vhost/www.drupal.my.rules;

    
    }
</code>
</pre>

<p><b><a href="#">返回顶部</a></b></p>
    </article>
  </main>
  <footer>
    <hr />
    <div class="c">
      <nav>
        <ul><li><a href="https://aqrun.com/atom.xml" target="_blank" title="Atom/RSS Feed"><i type="Button" class="svg rss" title="Atom/RSS Feed"></i></a></li><li class="js"><a class="m-protected" href="#YXFydW5Ac2luYS5jb20=" target="_blank" title="Mail"><i type="Button" class="svg mail" title="Mail"></i></a></li><li><a href="https://github.com/aqrun/" target="_blank" title="Github"><i type="Button" class="svg github" title="Github"></i></a></li></ul>
      </nav>
      <p class="s90">Copyright &copy; 2014-2023 光鹿跑冰</p>
      <nav>
        <ul><li class="s90"> <a href="https://aqrun.com/about/"> 关于我 </a> </li><li class="s90"> <a href="https://aqrun.com/contact/"> 联系我 </a> </li><li class="s90"> <a href="https://aqrun.com/privacy/"> 保护权益 </a> </li><li class="s90"> <a href="https://aqrun.com/sitemap.xml" target="_blank"> 网站地图 </a> </li></ul>
      </nav>
      <p class="s90">Powered by <a href="https://www.getzola.org/" target="_blank">Zola</a> 和 <a href="https://github.com/jieiku/abridge/" target="_blank">Abridge</a></p>
    </div>
  </footer>
<span class="topout">
<span class="topleft"> </span><a href="#" class="top" title="Back to Top"><i class="svgs svgh angu"></i></a>
</span>
</body>
</html>